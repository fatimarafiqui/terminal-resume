/**@license
 *       __ _____                     ________                              __
 *      / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /
 *  __ / // // // // // _  // _// // / / // _  // _//     // //  \/ // _ \/ /
 * /  / // // // // // ___// / / // / / // ___// / / / / // // /\  // // / /__
 * \___//____ \\___//____//_/ _\_  / /_//____//_/ /_/ /_//_//_/ /_/ \__\_\___/
 *           \/              /____/                              version 0.11.11
 *
 * This file is part of jQuery Terminal. http://terminal.jcubic.pl
 *
 * Copyright (c) 2010-2016 Jakub Jankiewicz <http://jcubic.pl>
 * Released under the MIT license
 *
 * Contains:
 *
 * Storage plugin Distributed under the MIT License
 * Copyright (c) 2010 Dave Schindler
 *
 * jQuery Timers licenced with the WTFPL
 * <http://jquery.offput.ca/timers/>
 *
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 *
 * jQuery Caret
 * Copyright (c) 2009, Gideon Sireling
 * 3 clause BSD License
 *
 * sprintf.js
 * Copyright (c) 2007-2013 Alexandru Marasteanu <hello at alexei dot ro>
 * licensed under 3 clause BSD license
 *
 * Date: Fri, 07 Oct 2016 15:43:15 +0000
 */
!function(e){function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,n){for(var t=[];n>0;t[--n]=e);return t.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};r.format=function(e,i){var o,a,s,c,l,u,f,p=1,h=e.length,m="",g=[];for(a=0;h>a;a++)if(m=n(e[a]),"string"===m)g.push(e[a]);else if("array"===m){if(c=e[a],c[2])for(o=i[p],s=0;s<c[2].length;s++){if(!o.hasOwnProperty(c[2][s]))throw r('[sprintf] property "%s" does not exist',c[2][s]);o=o[c[2][s]]}else o=c[1]?i[c[1]]:i[p++];if(/[^s]/.test(c[8])&&"number"!=n(o))throw r("[sprintf] expecting number but found %s",n(o));switch(c[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=c[7]?o.toExponential(c[7]):o.toExponential();break;case"f":o=c[7]?parseFloat(o).toFixed(c[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&c[7]?o.substring(0,c[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(c[8])&&c[3]&&o>=0?"+"+o:o,u=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",f=c[6]-String(o).length,l=c[6]?t(u,f):"",g.push(c[5]?o+l:l+o)}return g.join("")},r.cache={},r.parse=function(e){for(var n=e,t=[],r=[],i=0;n;){if(null!==(t=/^[^\x25]+/.exec(n)))r.push(t[0]);else if(null!==(t=/^\x25{2}/.exec(n)))r.push("%");else{if(null===(t=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw"[sprintf] huh?";if(t[2]){i|=1;var o=[],a=t[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";o.push(s[1])}t[2]=o}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(t)}n=n.substring(t[0].length)}return r};var i=function(e,n,t){return t=n.slice(0),t.splice(0,0,e),r.apply(null,t)};e.sprintf=r,e.vsprintf=i}("undefined"!=typeof global?global:window),function(e,n){"use strict";function t(e,n){var t;if("string"==typeof e&&"string"==typeof n)return localStorage[e]=n,!0;if("object"==typeof e&&"undefined"==typeof n){for(t in e)e.hasOwnProperty(t)&&(localStorage[t]=e[t]);return!0}return!1}function r(e,n){var t,r,i;if(t=new Date,t.setTime(t.getTime()+31536e6),r="; expires="+t.toGMTString(),"string"==typeof e&&"string"==typeof n)return document.cookie=e+"="+n+r+"; path=/",!0;if("object"==typeof e&&"undefined"==typeof n){for(i in e)e.hasOwnProperty(i)&&(document.cookie=i+"="+e[i]+r+"; path=/");return!0}return!1}function i(e){return localStorage[e]}function o(e){var n,t,r,i;for(n=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){for(i=t[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return i.substring(n.length,i.length)}return null}function a(e){return delete localStorage[e]}function s(e){return r(e,"",-1)}function c(e,n){var t=[],r=e.length;if(n>r)return[e];if(0>n)throw new Error("str_parts: length can't be negative");for(var i=0;r>i;i+=n)t.push(e.substring(i,i+n));return t}function l(n){var t=n?[n]:[],r=0;e.extend(this,{get:function(){return t},rotate:function(){return t.filter(Boolean).length?1===t.length?t[0]:(r===t.length-1?r=0:++r,t[r]?t[r]:this.rotate()):void 0},length:function(){return t.length},remove:function(e){delete t[e]},set:function(e){for(var n=t.length;n--;)if(t[n]===e)return void(r=n);this.append(e)},front:function(){if(t.length){for(var e=r,n=!1;!t[e];)if(e++,e>t.length){if(n)break;e=0,n=!0}return t[e]}},append:function(e){t.push(e)}})}function u(n){var t=n instanceof Array?n:n?[n]:[];e.extend(this,{data:function(){return t},map:function(n){return e.map(t,n)},size:function(){return t.length},pop:function(){if(0===t.length)return null;var e=t[t.length-1];return t=t.slice(0,t.length-1),e},push:function(e){return t=t.concat([e]),e},top:function(){return t.length>0?t[t.length-1]:null},clone:function(){return new u(t.slice(0))}})}function f(n,t){var r=!0,i="";"string"==typeof n&&""!==n&&(i=n+"_"),i+="commands";var o=e.Storage.get(i);o=o?e.parseJSON(o):[];var a=o.length-1;e.extend(this,{append:function(n){r&&o[o.length-1]!==n&&(o.push(n),t&&o.length>t&&(o=o.slice(-t)),a=o.length-1,e.Storage.set(i,e.json_stringify(o)))},data:function(){return o},reset:function(){a=o.length-1},last:function(){return o[o.length-1]},end:function(){return a===o.length-1},position:function(){return a},current:function(){return o[a]},next:function(){return a<o.length-1&&++a,-1!==a?o[a]:void 0},previous:function(){var e=a;return a>0&&--a,-1!==e?o[a]:void 0},clear:function(){o=[],this.purge()},enabled:function(){return r},enable:function(){r=!0},purge:function(){e.Storage.remove(i)},disable:function(){r=!1}})}function p(n,t){var r=t(n);if(r.length){var i=r.shift(),o=new RegExp("^"+e.terminal.escape_regex(i)),a=n.replace(o,"").trim();return{command:n,name:i,args:r,rest:a}}return{command:n,name:"",args:[],rest:""}}function h(){var n=e('<div class="terminal temp"><div class="cmd"><span class="cursor">&nbsp;</span></div></div>').appendTo("body"),t=n.find("span"),r={width:t.width(),height:t.outerHeight()};return n.remove(),r}function m(n){var t=e('<div class="terminal wrap"><span class="cursor">&nbsp;</span></div>').appendTo("body").css("padding",0),r=t.find("span"),i=r[0].getBoundingClientRect().width,o=Math.floor(n.width()/i);if(t.remove(),v(n)){var a=20,s=n.innerWidth()-n.width();o-=Math.ceil((a-s/2)/(i-1))}return o}function g(e){return Math.floor(e.height()/h().height)}function d(){if(window.getSelection||document.getSelection){var e=(window.getSelection||document.getSelection)();return e.text?e.text:e.toString()}return document.selection?document.selection.createRange().text:void 0}function v(n){return"scroll"==n.css("overflow")||"scroll"==n.css("overflow-y")?!0:n.is("body")?e("body").height()>e(window).height():n.get(0).scrollHeight>n.innerHeight()}e.omap=function(n,t){var r={};return e.each(n,function(e,i){r[e]=t.call(n,e,i)}),r};var y={clone_object:function(n){var t={};if("object"==typeof n){if(e.isArray(n))return this.clone_array(n);if(null===n)return n;for(var r in n)e.isArray(n[r])?t[r]=this.clone_array(n[r]):"object"==typeof n[r]?t[r]=this.clone_object(n[r]):t[r]=n[r]}return t},clone_array:function(n){if(!e.isFunction(Array.prototype.map))throw new Error("You'r browser don't support ES5 array map use es5-shim");return n.slice(0).map(function(e){return"object"==typeof e?this.clone_object(e):e}.bind(this))}},_=function(e){return y.clone_object(e)},w=function(){var e="test",n=window.localStorage;try{return n.setItem(e,"1"),n.removeItem(e),!0}catch(t){return!1}},b=w();e.extend({Storage:{set:b?t:r,get:b?i:o,remove:b?a:s}});var k=e;k.fn.extend({everyTime:function(e,n,t,r,i){return this.each(function(){k.timer.add(this,e,n,t,r,i)})},oneTime:function(e,n,t){return this.each(function(){k.timer.add(this,e,n,t,1)})},stopTime:function(e,n){return this.each(function(){k.timer.remove(this,e,n)})}}),k.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(e){if(e===n||null===e)return null;var t=this.regex.exec(k.trim(e.toString()));if(t[2]){var r=parseInt(t[1],10),i=this.powers[t[2]]||1;return r*i}return e},add:function(e,n,t,r,i,o){var a=0;if(k.isFunction(t)&&(i||(i=r),r=t,t=n),n=k.timer.timeParse(n),!("number"!=typeof n||isNaN(n)||0>=n)){i&&i.constructor!==Number&&(o=!!i,i=0),i=i||0,o=o||!1,e.$timers||(e.$timers={}),e.$timers[t]||(e.$timers[t]={}),r.$timerID=r.$timerID||this.guid++;var s=function(){o&&s.inProgress||(s.inProgress=!0,(++a>i&&0!==i||r.call(e,a)===!1)&&k.timer.remove(e,t,r),s.inProgress=!1)};s.$timerID=r.$timerID,e.$timers[t][r.$timerID]||(e.$timers[t][r.$timerID]=window.setInterval(s,n)),this.global[t]||(this.global[t]=[]),this.global[t].push(e)}},remove:function(e,n,t){var r,i=e.$timers;if(i){if(n){if(i[n]){if(t)t.$timerID&&(window.clearInterval(i[n][t.$timerID]),delete i[n][t.$timerID]);else for(var o in i[n])i[n].hasOwnProperty(o)&&(window.clearInterval(i[n][o]),delete i[n][o]);for(r in i[n])if(i[n].hasOwnProperty(r))break;r||(r=null,delete i[n])}}else for(var a in i)i.hasOwnProperty(a)&&this.remove(e,a,t);for(r in i)if(i.hasOwnProperty(r))break;r||(e.$timers=null)}}}}),/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&k(window).one("unload",function(){var e=k.timer.global;for(var n in e)if(e.hasOwnProperty(n))for(var t=e[n],r=t.length;--r;)k.timer.remove(t[r],n)}),function(e){if(String.prototype.split.toString().match(/\[native/)){var n,t=String.prototype.split,r=/()??/.exec("")[1]===e;return n=function(n,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return t.call(n,i,o);var a,s,c,l,u=[],f=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),p=0;for(i=new RegExp(i.source,f+"g"),n+="",r||(a=new RegExp("^"+i.source+"$(?!\\s)",f)),o=o===e?-1>>>0:o>>>0;(s=i.exec(n))&&(c=s.index+s[0].length,!(c>p&&(u.push(n.slice(p,s.index)),!r&&s.length>1&&s[0].replace(a,function(){for(var n=1;n<arguments.length-2;n++)arguments[n]===e&&(s[n]=e)}),s.length>1&&s.index<n.length&&Array.prototype.push.apply(u,s.slice(1)),l=s[0].length,p=c,u.length>=o)));)i.lastIndex===s.index&&i.lastIndex++;return p===n.length?!l&&i.test("")||u.push(""):u.push(n.slice(p)),u.length>o?u.slice(0,o):u},String.prototype.split=function(e,t){return n(this,e,t)},n}}(),e.fn.caret=function(e){var n=this[0],t="true"===n.contentEditable;if(0==arguments.length){if(window.getSelection){if(t){n.focus();var r=window.getSelection().getRangeAt(0),i=r.cloneRange();return i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),i.toString().length}return n.selectionStart}if(document.selection){if(n.focus(),t){var r=document.selection.createRange(),i=document.body.createTextRange();return i.moveToElementText(n),i.setEndPoint("EndToEnd",r),i.text.length}var e=0,o=n.createTextRange(),i=document.selection.createRange().duplicate(),a=i.getBookmark();for(o.moveToBookmark(a);0!==o.moveStart("character",-1);)e++;return e}return 0}if(-1==e&&(e=this[t?"text":"val"]().length),window.getSelection)t?(n.focus(),window.getSelection().collapse(n.firstChild,e)):n.setSelectionRange(e,e);else if(document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(n),o.moveStart("character",e),o.collapse(!0),o.select()}return t||n.focus(),e},e.json_stringify=function(t,r){var i,o="";r=r===n?1:r;var a=typeof t;switch(a){case"function":o+=t;break;case"boolean":o+=t?"true":"false";break;case"object":if(null===t)o+="null";else if(t instanceof Array){o+="[";var s=t.length;for(i=0;s-1>i;++i)o+=e.json_stringify(t[i],r+1);o+=e.json_stringify(t[s-1],r+1)+"]"}else{o+="{";for(var c in t)t.hasOwnProperty(c)&&(o+='"'+c+'":'+e.json_stringify(t[c],r+1));o+="}"}break;case"string":var l=t,u={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(i in u)u.hasOwnProperty(i)&&(l=l.replace(new RegExp(i,"g"),u[i]));o+='"'+l+'"';break;case"number":o+=String(t)}return o+=r>1?",":"",1===r&&(o=o.replace(/,([\]}])/g,"$1")),o.replace(/([\[{]),/g,"$1")};var x=function(){var e=document.createElement("div");return e.setAttribute("onpaste","return;"),"function"==typeof e.onpaste}();e.fn.cmd=function(t){function r(){var e=b.is(":focus");R?e||(b.focus(),_.oneTime(10,function(){b.focus()})):e&&b.blur()}function i(){T&&_.oneTime(10,function(){b.val(D),_.oneTime(10,function(){b.caret(W)})})}function o(){J.toggleClass("inverted")}function a(){j="(reverse-i-search)`"+N+"': ",Q()}function s(){j=E,K=!1,P=null,N=""}function l(n){var t,r,i=I.data(),o=i.length;if(n&&P>0&&(o-=P),N.length>0)for(var s=N.length;s>0;s--){r=e.terminal.escape_regex(N.substring(0,s)),t=new RegExp(r);for(var c=o;c--;)if(t.test(i[c]))return P=i.length-c,_.position(i[c].indexOf(r)),_.set(i[c],!0),G(),void(N.length!==s&&(N=N.substring(0,s),a()))}N=""}function u(){var e=_.width(),n=J[0].getBoundingClientRect().width;k=Math.floor(e/n)}function p(e){var n=e.substring(0,k-F),t=e.substring(k-F);return[n].concat(c(t,k))}function h(e){if(!(M++>0)&&(e.originalEvent&&(e=e.originalEvent),_.isenabled())){var n=_.find("textarea");n.is(":focus")||n.focus(),_.oneTime(100,function(){_.insert(n.val()),n.val(""),i()})}}function m(r){var i,o,c;if(R){if(e.isFunction(t.keydown)&&(i=t.keydown(r),i!==n))return i;if(38===r.which||80===r.which&&r.ctrlKey||(X=!0),!K||35!==r.which&&36!==r.which&&37!==r.which&&38!==r.which&&39!==r.which&&40!==r.which&&13!==r.which&&27!==r.which){if(r.altKey)return 68===r.which?(_.set(D.slice(0,W)+D.slice(W).replace(/ *[^ ]+ *(?= )|[^ ]+$/,""),!0),!1):!0;if(13===r.keyCode)if(r.shiftKey)_.insert("\n");else{(I&&D&&!L&&e.isFunction(t.historyFilter)&&t.historyFilter(D)||t.historyFilter instanceof RegExp&&D.match(t.historyFilter)||!t.historyFilter)&&I.append(D);var u=D;I.reset(),_.set(""),t.commands&&t.commands(u),e.isFunction(j)&&Q()}else if(8===r.which){if(K?(N=N.slice(0,-1),a()):""!==D&&W>0&&_["delete"](-1),T)return!0}else if(67===r.which&&r.ctrlKey&&r.shiftKey)B=d();else if(86===r.which&&r.ctrlKey&&r.shiftKey)""!==B&&_.insert(B);else if(9!==r.which||r.ctrlKey||r.altKey){if(46===r.which)return void _["delete"](1);if(I&&38===r.which&&!r.ctrlKey||80===r.which&&r.ctrlKey)X?(A=D,_.set(I.current())):_.set(I.previous()),X=!1;else if(I&&40===r.which&&!r.ctrlKey||78===r.which&&r.ctrlKey)_.set(I.end()?A:I.next());else if(37===r.which||66===r.which&&r.ctrlKey)if(r.ctrlKey&&66!==r.which){c=W-1,o=0," "===D[c]&&--c;for(var f=c;f>0;--f){if(" "===D[f]&&" "!==D[f+1]){o=f+1;break}if("\n"===D[f]&&"\n"!==D[f+1]){o=f;break}}_.position(o)}else W>0&&(_.position(-1,!0),G());else if(82===r.which&&r.ctrlKey)K?l(!0):(E=j,a(),A=D,_.set(""),G(),K=!0);else if(71==r.which&&r.ctrlKey)K&&(j=E,Q(),_.set(A),G(),K=!1,N="");else if(39===r.which||70===r.which&&r.ctrlKey)if(r.ctrlKey&&70!==r.which){" "===D[W]&&++W;var p=/\S[\n\s]{2,}|[\n\s]+\S?/,g=D.slice(W).match(p);!g||g[0].match(/^\s+$/)?_.position(D.length):" "!==g[0][0]?W+=g.index+1:(W+=g.index+g[0].length-1," "!==g[0][g[0].length-1]&&--W),G()}else W<D.length&&_.position(1,!0);else{if(123===r.which)return;if(36===r.which)_.position(0);else if(35===r.which)_.position(D.length);else{if(r.shiftKey&&45==r.which)return b.val(""),M=0,void(x?b.focus():h(r));if(!r.ctrlKey&&!r.metaKey)return Z=!1,void(Y=!0);if(192===r.which)return;if(r.metaKey){if(82===r.which)return;if(76===r.which)return}if(r.shiftKey){if(84===r.which)return}else{if(81===r.which){if(""!==D&&0!==W){var v=D.slice(0,W).match(/([^ ]+ *$)/);H=_["delete"](-v[0].length)}return!1}if(72===r.which)return""!==D&&W>0&&_["delete"](-1),!1;if(65===r.which)_.position(0);else if(69===r.which)_.position(D.length);else{if(88===r.which||67===r.which||84===r.which)return;if(89===r.which)""!==H&&_.insert(H);else{if(86===r.which||118===r.which)return b.val(""),M=0,void(x?(b.focus(),b.on("input",function y(e){h(e),b.off("input",y)})):h(r));if(75===r.which)H=_["delete"](D.length-W);else if(85===r.which)""!==D&&0!==W&&(H=_["delete"](-W));else if(17===r.which)return!1}}}}}}else _.insert("	")}else s(),Q(),27===r.which&&_.set(""),G(),m.call(this,r);r.preventDefault()}}function g(){e.isFunction(t.onCommandChange)&&t.onCommandChange(D)}function v(r){var i;if(Y=!1,(!r.ctrlKey&&!r.metaKey||-1===[99,118,86].indexOf(r.which))&&!Z){if(!K&&e.isFunction(t.keypress)&&(i=t.keypress(r)),i!==n&&!i)return i;if(R){if(e.inArray(r.which,[38,13,0,8])>-1&&(38!==r.which||!r.shiftKey)){if(123==r.keyCode)return;return!1}if(!r.ctrlKey&&(!r.altKey||100!==r.which)||r.altKey)return K?(N+=String.fromCharCode(r.which),l(),a()):_.insert(String.fromCharCode(r.which)),!1}}}function y(e){if(Y){var n=b.val();(n||8==e.which)&&_.set(n)}}var _=this,w=_.data("cmd");if(w)return w;_.addClass("cmd"),_.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var b=e("<textarea>").addClass("clipboard").appendTo(_);t.width&&_.width(t.width);var k,F,E,A,j,R,$,I,z,O=_.find(".prompt"),K=!1,N="",P=null,L=t.mask||!1,D="",B="",H="",W=0,q=t.historySize||60,J=_.find(".cursor"),M=0;if(C&&!S)z=function(e){e?J.addClass("blink"):J.removeClass("blink")};else{var U=!1;z=function(e){e&&!U?(U=!0,J.addClass("inverted blink"),_.everyTime(500,"blink",o)):U&&!e&&(U=!1,_.stopTime("blink",o),J.removeClass("inverted blink"))}}var Y,G=function(n){function t(n,t){var r=n.length;if(t===r)a.html(e.terminal.encode(n)),J.html("&nbsp;"),s.html("");else if(0===t)a.html(""),J.html(e.terminal.encode(n.slice(0,1))),s.html(e.terminal.encode(n.slice(1)));else{var i=n.slice(0,t);a.html(e.terminal.encode(i));var o=n.slice(t,t+1);J.html(e.terminal.encode(o)),t===n.length-1?s.html(""):s.html(e.terminal.encode(n.slice(t+1)))}}function r(n){return"<div>"+e.terminal.encode(n)+"</div>"}function i(n){var t=s;e.each(n,function(n,i){t=e(r(i)).insertAfter(t).addClass("clear")})}function o(n){e.each(n,function(e,n){a.before(r(n))})}var a=J.prev(),s=J.next();return function(){var l,u;switch(typeof L){case"boolean":l=L?D.replace(/./g,"*"):D;break;case"string":l=D.replace(/./g,L)}var f,h;if(n.find("div").remove(),a.html(""),l.length>k-F-1||l.match(/\n/)){var m,g=l.match(/\t/g),d=g?3*g.length:0;if(g&&(l=l.replace(/\t/g,"\x00\x00\x00\x00")),l.match(/\n/)){var v=l.split("\n");for(h=k-F-1,f=0;f<v.length-1;++f)v[f]+=" ";for(v[0].length>h?(m=[v[0].substring(0,h)],u=v[0].substring(h),m=m.concat(c(u,k))):m=[v[0]],f=1;f<v.length;++f)v[f].length>k?m=m.concat(c(v[f],k)):m.push(v[f])}else m=p(l);if(g&&(m=e.map(m,function(e){return e.replace(/\x00\x00\x00\x00/g,"	")})),h=m[0].length,0===h&&1===m.length);else if(h>W)t(m[0],W),i(m.slice(1));else if(W===h)a.before(r(m[0])),t(m[1],0),i(m.slice(2));else{var y=m.length;if(h>W)t(m[0],W),i(m.slice(1));else if(W===h)a.before(r(m[0])),t(m[1],0),i(m.slice(2));else{var _=m.slice(-1)[0],w=l.length-W-d,b=_.length,x=0;if(b>=w)o(m.slice(0,-1)),x=b===w?0:b-w,t(_,x);else if(3===y)u=e.terminal.encode(m[0]),a.before("<div>"+u+"</div>"),t(m[1],W-h-1),u=e.terminal.encode(m[2]),s.after('<div class="clear">'+u+"</div>");else{var C,S;for(x=W,f=0;f<m.length;++f){var T=m[f].length;if(!(x>T))break;x-=T}S=m[f],C=f,x===S.length&&(x=0,S=m[++C]),t(S,x),o(m.slice(0,C)),i(m.slice(C+1))}}}}else""===l?(a.html(""),J.html("&nbsp;"),s.html("")):t(l,W)}}(_),Q=function(){function n(n){O.html(e.terminal.format(e.terminal.encode(n))),F=O.text().length}return function(){switch(typeof j){case"string":n(j);break;case"function":j(n)}}}(),X=!0,Z=!1;e.extend(_,{name:function(e){if(e!==n){$=e;var t=I&&I.enabled()||!I;return I=new f(e,q),t||I.disable(),_}return $},purge:function(){return I.clear(),_},history:function(){return I},"delete":function(e,n){var t;return 0===e?_:(0>e?W>0&&(t=D.slice(0,W).slice(e),D=D.slice(0,W+e)+D.slice(W,D.length),n?g():_.position(W+e)):""!==D&&W<D.length&&(t=D.slice(W).slice(0,e),D=D.slice(0,W)+D.slice(W+e,D.length),g()),G(),i(),t)},set:function(e,t){return e!==n&&(D=e,t||_.position(D.length),G(),i(),g()),_},insert:function(e,n){return W===D.length?D+=e:D=0===W?e+D:D.slice(0,W)+e+D.slice(W),n?i():_.position(e.length,!0),G(),g(),_},get:function(){return D},commands:function(e){return e?(t.commands=e,_):e},destroy:function(){return V.unbind("keypress.cmd",v),V.unbind("keydown.cmd",m),V.unbind("paste.cmd",h),V.unbind("input.cmd",y),_.stopTime("blink",o),_.find(".cursor").next().remove().end().prev().remove().end().remove(),_.find(".prompt, .clipboard").remove(),_.removeClass("cmd").removeData("cmd"),_},prompt:function(e){if(e===n)return j;if("string"!=typeof e&&"function"!=typeof e)throw new Error("prompt must be a function or string");return j=e,Q(),G(),_},kill_text:function(){return H},position:function(n,r){return"number"==typeof n?(r?W+=n:W=0>n?0:n>D.length?D.length:n,e.isFunction(t.onPositionChange)&&t.onPositionChange(W),G(),i(),_):W},visible:function(){var e=_.visible;return function(){e.apply(_,[]),G(),Q()}}(),show:function(){var e=_.show;return function(){e.apply(_,[]),G(),Q()}}(),resize:function(e){return e?k=e:u(),G(),_},enable:function(){return R=!0,_.addClass("enabled"),z(!0),r(),_},isenabled:function(){return R},disable:function(){return R=!1,_.removeClass("enabled"),z(!1),r(),_},mask:function(e){return"undefined"==typeof e?L:(L=e,G(),_)}}),_.name(t.name||t.prompt||""),j="string"==typeof t.prompt?t.prompt:"> ",Q(),t.enabled!==n&&t.enabled!==!0||_.enable();var V=e(document.documentElement||window);return V.bind("keypress.cmd",v).bind("keydown.cmd",m).bind("input.cmd",y),_.data("cmd",_),_};var C=function(){var e=!1,t="animation",r="",i="Webkit Moz O ms Khtml".split(" "),o="",a=document.createElement("div");if(a.style.animationName&&(e=!0),e===!1)for(var s=0;s<i.length;s++){var c=i[s]+"AnimationName";if(a.style[c]!==n){o=i[s],t=o+"Animation",r="-"+o.toLowerCase()+"-",e=!0;break}}return e}(),S=-1!=navigator.userAgent.toLowerCase().indexOf("android"),T=function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}(),F=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/i,E=/\[\[([!gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,A=/\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,j=/\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]/gi,R=/^\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,$=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,I=/(\bhttps?:\/\/(?:(?:(?!&[^;]+;)|(?=&amp;))[^\s"'<>\]\[)])+\b)/gi,z=/\b(https?:\/\/(?:(?:(?!&[^;]+;)|(?=&amp;))[^\s"'<>\][)])+)\b(?![^[\]]*])/gi,O=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,K=/('[^']*'|"(\\"|[^"])*"|(?:\/(\\\/|[^\/])+\/[gimy]*)(?=:? |$)|(\\ |[^ ])+|[\w-]+)/gi,N=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\])/i,P=/^(\[\[[!gbiuso]*;[^;]*;[^\]]*\])/i,L=/\[\[[!gbiuso]*;[^;]*;[^\]]*\]?$/i,D=/(\[\[(?:[^\]]|\\\])*\]\])/;e.terminal={version:"0.11.10",color_names:["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],valid_color:function(n){return n.match($)?!0:-1!==e.inArray(n.toLowerCase(),e.terminal.color_names)},escape_regex:function(e){if("string"==typeof e){var n=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(n,"\\$1")}},have_formatting:function(e){return"string"==typeof e&&!!e.match(j)},is_formatting:function(e){return"string"==typeof e&&!!e.match(R)},format_split:function(e){return e.split(F)},split_equal:function(n,t,r){function i(){return"&nbsp;"==p.substring(d-6,d)||" "==p.substring(d-1,d)}for(var o=!1,a=!1,s="",c=[],l=n.replace(A,function(e,n,t){var r=n.match(/;/g).length;if(r>=4)return e;r=2==r?";;":3==r?";":"";var i=t.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n").replace(/&nbsp;/g," ");return"[["+n+r+i+"]"+t+"]"}).split(/\n/g),u=0,f=l.length;f>u;++u)if(""!==l[u])for(var p=l[u],h=0,m=0,g=-1,d=0,v=p.length;v>d;++d){if(p.substring(d).match(P))o=!0,a=!1;else if(o&&"]"===p[d])a?(o=!1,a=!1):a=!0;else if(o&&a||!o){if("&"===p[d]){var y=p.substring(d).match(/^(&[^;]+;)/);if(!y)throw new Error("Unclosed html entity in line "+(u+1)+" at char "+(d+1));d+=y[1].length-2,d===v-1&&c.push(_+y[1]);continue}"]"===p[d]&&"\\"===p[d-1]?--m:++m}if(i()&&(o&&a||!o||"["===p[d]&&"["===p[d+1])&&(g=d),(m===t||d===v-1)&&(o&&a||!o)){var _,w=e.terminal.strip(p.substring(g));w=e("<span>"+w+"</span>").text();var b=w.length;w=w.substring(0,d+t+1);var k=!!w.match(/\s/)||d+t+1>b;r&&-1!=g&&d!==v-1&&k?(_=p.substring(h,g),d=g-1):_=p.substring(h,d+1),r&&(_=_.replace(/(&nbsp;|\s)+$/g,"")),g=-1,h=d+1,m=0,s&&(_=s+_,_.match("]")&&(s=""));var x=_.match(A);if(x){var C=x[x.length-1];if("]"!==C[C.length-1])s=C.match(N)[1],_+="]";else if(_.match(L)){_.length;_=_.replace(L,""),s=C.match(N)[1]}}c.push(_)}}else c.push("");return c},encode:function(e){return e=e.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},escape_formatting:function(n){return e.terminal.escape_brackets(e.terminal.encode(n))},format:function(n,t){var r=e.extend({},{linksNoReferrer:!1},t||{});if("string"==typeof n){var i=e.terminal.format_split(n);return n=e.map(i,function(n){return""===n?n:e.terminal.is_formatting(n)?(n=n.replace(/\[\[[^\]]+\]/,function(e){return e.replace(/&nbsp;/g," ")}),n.replace(E,function(n,t,i,o,a,s,c){if(""===c)return"";c=c.replace(/\\]/g,"]");var l="";-1!==t.indexOf("b")&&(l+="font-weight:bold;");var u=[];-1!==t.indexOf("u")&&u.push("underline"),-1!==t.indexOf("s")&&u.push("line-through"),-1!==t.indexOf("o")&&u.push("overline"),u.length&&(l+="text-decoration:"+u.join(" ")+";"),-1!==t.indexOf("i")&&(l+="font-style:italic;"),e.terminal.valid_color(i)&&(l+="color:"+i+";",-1!==t.indexOf("g")&&(l+="text-shadow:0 0 5px "+i+";")),e.terminal.valid_color(o)&&(l+="background-color:"+o);var f;f=""===s?c:s.replace(/&#93;/g,"]");var p;return-1!==t.indexOf("!")?f.match(O)?p='<a href="mailto:'+f+'" ':(p='<a target="_blank" href="'+f+'" ',r.linksNoReferrer&&(p+='rel="noreferrer" ')):p="<span",""!==l&&(p+=' style="'+l+'"'),""!==a&&(p+=' class="'+a+'"'),p+=-1!==t.indexOf("!")?">"+c+"</a>":' data-text="'+f.replace('"',"&quote;")+'">'+c+"</span>"})):"<span>"+n.replace(/\\\]/g,"]")+"</span>"}).join(""),n.replace(/<span><br\s*\/?><\/span>/gi,"<br/>")}return""},escape_brackets:function(e){return e.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(e){return e.replace(E,"$6")},active:function(){return Q.front()},last_id:function(){var e=Q.length();return e?e-1:void 0},parseArguments:function(n){return e.terminal.parse_arguments(n)},splitArguments:function(n){return e.terminal.split_arguments(n)},parseCommand:function(n){return e.terminal.parse_command(n)},splitCommand:function(n){return e.terminal.split_command(n)},parse_arguments:function(n){var t=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;return e.map(n.match(K)||[],function(e){if("'"===e[0]&&"'"===e[e.length-1])return e.replace(/^'|'$/g,"");if('"'===e[0]&&'"'===e[e.length-1])return e=e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),e.replace(/\\\\|\\t|\\n/g,function(e){return"t"===e[1]?"	":"n"===e[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(e,n){return String.fromCharCode(parseInt(n,16))}).replace(/\\0([0-7]+)/g,function(e,n){return String.fromCharCode(parseInt(n,8))});if(e.match(/^\/(\\\/|[^\/])+\/[gimy]*$/)){var n=e.match(/^\/([^\/]+)\/([^\/]*)$/);return new RegExp(n[1],n[2])}return e.match(/^-?[0-9]+$/)?parseInt(e,10):e.match(t)?parseFloat(e):e.replace(/\\ /g," ")})},split_arguments:function(n){return e.map(n.match(K)||[],function(e){return"'"===e[0]&&"'"===e[e.length-1]?e.replace(/^'|'$/g,""):'"'===e[0]&&'"'===e[e.length-1]?e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):e.match(/\/.*\/[gimy]*$/)?e:e.replace(/\\ /g," ")})},parse_command:function(n){return p(n,e.terminal.parse_arguments)},split_command:function(n){return p(n,e.terminal.split_arguments)},extended_command:function(e,n){try{Z=!1,e.exec(n,!0).then(function(){Z=!0})}catch(t){}}},e.fn.visible=function(){return this.css("visibility","visible")},e.fn.hidden=function(){return this.css("visibility","hidden")};var B={};e.jrpc=function(n,t,r,i,o){B[n]=B[n]||0;var a=e.json_stringify({jsonrpc:"2.0",method:t,params:r,id:++B[n]});return e.ajax({url:n,data:a,success:function(n,t,r){var a=r.getResponseHeader("Content-Type");if(!a.match(/application\/json/)){var s="Response Content-Type is not application/json";if(!console||!console.warn)throw new Error("WARN: "+s);console.warn(s)}var c;try{c=e.parseJSON(n)}catch(l){if(!o)throw new Error("Invalid JSON");return void o(r,"Invalid JSON",l)}i(c,t,r)},error:o,contentType:"application/json",dataType:"text",async:!0,cache:!1,type:"POST"})};var H=!e.terminal.version.match(/^\{\{/),W="Copyright (c) 2011-2016 Jakub Jankiewicz <http://jcubic.pl>",q=H?" v. "+e.terminal.version:" ",J=new RegExp(" {"+q.length+"}$"),M="jQuery Terminal Emulator"+(H?q:""),U=[["jQuery Terminal","(c) 2011-2016 jcubic"],[M,W.replace(/^Copyright | *<.*>/g,"")],[M,W.replace(/^Copyright /,"")],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/_/_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(J," ")+q,W],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(J,"")+q,W]];e.terminal.defaults={prompt:"> ",history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,maskChar:"*",checkArity:!0,raw:!1,exceptionHandler:null,cancelableAjax:!0,processArguments:!0,linksNoReferrer:!1,processRPCResponse:null,Token:!0,convertLinks:!0,historyState:!1,echoCommand:!0,scrollOnEcho:!0,login:null,outputLimit:-1,formatters:[],onAjaxError:null,onRPCError:null,completion:!1,historyFilter:null,onInit:e.noop,onClear:e.noop,onBlur:e.noop,onFocus:e.noop,onTerminalChange:e.noop,onExit:e.noop,keypress:e.noop,keydown:e.noop,strings:{wrongPasswordTryAgain:"Wrong password try again!",wrongPassword:"Wrong password!",ajaxAbortError:"Error while aborting ajax call!",wrongArity:"Wrong number of arguments. Function '%s' expects %s got %s!",commandNotFound:"Command '%s' Not Found!",oneRPCWithIgnore:"You can use only one rpc with ignoreSystemDescribe",oneInterpreterFunction:"You can't use more than one function (rpcwith ignoreSystemDescribe counts as one)",loginFunctionMissing:"You didn't specify a login function",noTokenError:"Access denied (no token)",serverResponse:"Server responded",wrongGreetings:"Wrong value of greetings parameter",
notWhileLogin:"You can't call `%s' function while in login",loginIsNotAFunction:"Authenticate must be a function",canExitError:"You can't exit from main interpreter",invalidCompletion:"Invalid completion",invalidSelector:'Sorry, but terminal said that "%s" is not valid selector!',invalidTerminalId:"Invalid Terminal ID",login:"login",password:"password",recursiveCall:"Recursive call detected, skip"}};var Y,G=[],Q=new l,X=[],Z=!1,V=!0,ee=!0;e.fn.terminal=function(t,r){function i(n){return e.isFunction(Ce.processArguments)?p(n,Ce.processArguments):Ce.processArguments?e.terminal.parse_command(n):e.terminal.split_command(n)}function o(n){"string"==typeof n?se.echo(n):n instanceof Array?se.echo(e.map(n,function(n){return e.json_stringify(n)}).join(" ")):"object"==typeof n?se.echo(e.json_stringify(n)):se.echo(n)}function a(n){var t=/(.*):([0-9]+):([0-9]+)$/,r=n.match(t);r&&(se.pause(),e.get(r[1],function(n){var t=location.href.replace(/[^\/]+$/,""),i=r[1].replace(t,"");se.echo("[[b;white;]"+i+"]");var o=n.split("\n"),a=+r[2]-1;se.echo(o.slice(a-2,a+3).map(function(n,t){return 2==t&&(n="[[;#f00;]"+e.terminal.escape_brackets(n)+"]"),"["+(a+t)+"]: "+n}).join("\n")).resume()},"text"))}function s(n){if(e.isFunction(Ce.onRPCError))Ce.onRPCError.call(se,n);else if(se.error("&#91;RPC&#93; "+n.message),n.error&&n.error.message){n=n.error;var t="	"+n.message;n.file&&(t+=' in file "'+n.file.replace(/.*\//,"")+'"'),n.at&&(t+=" at line "+n.at),se.error(t)}}function c(n,t){var r=function(t,r){se.pause(),e.jrpc(n,t,r,function(n){n.error?s(n.error):e.isFunction(Ce.processRPCResponse)?Ce.processRPCResponse.call(se,n.result,se):o(n.result),se.resume()},f)};return function(e,n){if(""!==e){try{e=i(e)}catch(o){return void n.error(o.toString())}if(t&&"help"!==e.name){var a=n.token();a?r(e.name,[a].concat(e.args)):n.error("&#91;AUTH&#93; "+Se.noTokenError)}else r(e.name,e.args)}}}function l(t,r,o,a){return function(s,c){if(""!==s){var u;try{u=i(s)}catch(f){return void se.error(f.toString())}var p=t[u.name],h=e.type(p);if("function"===h){if(!r||p.length===u.args.length)return p.apply(se,u.args);se.error("&#91;Arity&#93; "+sprintf(Se.wrongArity,u.name,p.length,u.args.length))}else if("object"===h||"string"===h){var m=[];"object"===h&&(m=Object.keys(p),p=l(p,r,o)),c.push(p,{prompt:u.name+"> ",name:u.name,completion:"object"===h?m:n})}else e.isFunction(a)?a(s,se):e.isFunction(Ce.onCommandNotFound)?Ce.onCommandNotFound(s,se):c.error(sprintf(Se.commandNotFound,u.name))}}}function f(n,t,r){se.resume(),e.isFunction(Ce.onAjaxError)?Ce.onAjaxError.call(se,n,t,r):"abort"!==t&&se.error("&#91;AJAX&#93; "+t+" - "+Se.serverResponse+": \n"+e.terminal.escape_brackets(n.responseText))}function h(n,t,r){e.jrpc(n,"system.describe",[],function(i){if(i.procs){var a={};e.each(i.procs,function(r,i){a[i.name]=function(){var r=t&&"help"!=i.name,a=Array.prototype.slice.call(arguments),c=a.length+(r?1:0);if(Ce.checkArity&&i.params&&i.params.length!==c)se.error("&#91;Arity&#93; "+sprintf(Se.wrongArity,i.name,i.params.length,c));else{if(se.pause(),r){var l=se.token(!0);l?a=[l].concat(a):se.error("&#91;AUTH&#93; "+Se.noTokenError)}e.jrpc(n,i.name,a,function(n){n.error?s(n.error):e.isFunction(Ce.processRPCResponse)?Ce.processRPCResponse.call(se,n.result,se):o(n.result),se.resume()},f)}}}),a.help=a.help||function(n){if("undefined"==typeof n)se.echo("Available commands: "+i.procs.map(function(e){return e.name}).join(", ")+", help");else{var t=!1;if(e.each(i.procs,function(e,r){if(r.name==n){t=!0;var i="";return i+="[[bu;#fff;]"+r.name+"]",r.params&&(i+=" "+r.params.join(" ")),r.help&&(i+="\n"+r.help),se.echo(i),!1}}),!t)if("help"==n)se.echo("[[bu;#fff;]help] [method]\ndisplay help for the method or list of methods if not specified");else{var r="Method `"+n.toString()+"' not found ";se.error(r)}}},r(a)}else r(null)},function(){r(null)})}function y(n,t,r){r=r||e.noop;var i,o,a=e.type(n),s={},u=0;if("array"===a)i={},function f(n,r){if(n.length){var a=n[0],s=n.slice(1),l=e.type(a);"string"===l?(u++,se.pause(),Ce.ignoreSystemDescribe?(1===u?o=c(a,t):se.error(Se.oneRPCWithIgnore),f(s,r)):h(a,t,function(n){n&&e.extend(i,n),se.resume(),f(s,r)})):"function"===l?(o?se.error(Se.oneInterpreterFunction):o=a,f(s,r)):"object"===l&&(e.extend(i,a),f(s,r))}else r()}(n,function(){r({interpreter:l(i,!1,t,o),completion:Object.keys(i)})});else if("string"===a)Ce.ignoreSystemDescribe?(i={interpreter:c(n,t)},e.isArray(Ce.completion)&&(i.completion=Ce.completion),r(i)):(se.pause(),h(n,t,function(e){e?(s.interpreter=l(e,!1,t),s.completion=Object.keys(e)):s.interpreter=c(n,t),r(s),se.resume()}));else if("object"===a)r({interpreter:l(n,Ce.checkArity),completion:Object.keys(n)});else{if("undefined"===a)n=e.noop;else if("function"!==a)throw a+" is invalid interpreter value";r({interpreter:n,completion:Ce.completion})}}function w(n,t){var r="boolean"===e.type(t)?"login":t;return function(t,i,o){se.pause(),e.jrpc(n,r,[t,i],function(e){o(!e.error&&e.result?e.result:null),se.resume()},f)}}function b(e){return"string"==typeof e?e:"string"==typeof e.fileName?e.fileName+": "+e.message:e.message}function k(n,t){e.isFunction(Ce.exceptionHandler)?Ce.exceptionHandler.call(se,n):se.exception(n,t)}function x(){var e;e=ce.prop?ce.prop("scrollHeight"):ce.attr("scrollHeight"),ce.scrollTop(e)}function C(n,t){try{if(e.isFunction(t))t(function(){});else if("string"!=typeof t){var r=n+" must be string or function";throw r}}catch(i){return k(i,n.toUpperCase()),!1}return!0}function S(n,t){Ce.convertLinks&&(n=n.replace(O,"[[!;;]$1]").replace(z,"[[!;;]$1]"));var r,i,o=e.terminal.defaults.formatters;if(!t.raw){for(r=0;r<o.length;++r)try{if("function"==typeof o[r]){var a=o[r](n);"string"==typeof a&&(n=a)}}catch(s){alert("formatting error at formatters["+r+"]\n"+(s.stack?s.stack:s))}n=e.terminal.encode(n)}if(re.push(ie),!t.raw&&(n.length>fe||n.match(/\n/))){var c=t.keepWords,l=e.terminal.split_equal(n,fe,c);for(r=0,i=l.length;i>r;++r)""===l[r]||"\r"===l[r]?re.push("<span></span>"):t.raw?re.push(l[r]):re.push(e.terminal.format(l[r],{linksNoReferrer:Ce.linksNoReferrer}))}else t.raw||(n=e.terminal.format(n,{linksNoReferrer:Ce.linksNoReferrer})),re.push(n);re.push(t.finalize)}function F(n,t){try{var r=e.extend({exec:!0,raw:!1,finalize:e.noop},t||{}),i="function"===e.type(n)?n():n;i="string"===e.type(i)?i:String(i),""!==i&&(r.exec?(i=e.map(i.split(D),function(n){return n.match(D)&&!e.terminal.is_formatting(n)?(n=n.replace(/^\[\[|\]\]$/g,""),le&&le.command==n?se.error(Se.recursiveCall):e.terminal.extended_command(se,n),""):n}).join(""),""!==i&&S(i,r)):S(i,r))}catch(o){re=[],alert("[Internal Exception(process_line)]:"+b(o)+"\n"+o.stack)}}function E(){Ke.resize(fe);var n,t=ue.empty().detach();if(Ce.outputLimit>=0){var r=0===Ce.outputLimit?se.rows():Ce.outputLimit;n=ve.slice(ve.length-r-1)}else n=ve;try{re=[],e.each(n,function(e,n){F.apply(null,n)}),Ke.before(t),se.flush()}catch(i){alert("Exception in redraw\n"+i.stack)}}function A(){if(Ce.greetings===n)se.echo(se.signature);else if(Ce.greetings){var e=typeof Ce.greetings;"string"===e?se.echo(Ce.greetings):"function"===e?Ce.greetings.call(se,se.echo):se.error(Se.wrongGreetings)}}function j(n){var t=Ke.prompt(),r=Ke.mask();switch(typeof r){case"string":n=n.replace(/./g,r);break;case"boolean":n=r?n.replace(/./g,Ce.maskChar):e.terminal.escape_formatting(n)}var i={finalize:function(e){e.addClass("command")}};e.isFunction(t)?t(function(e){se.echo(e+n,i)}):se.echo(t+n,i)}function R(e){var n=Q.get()[e[0]];if(!n)throw new Error(Se.invalidTerminalId);var t=e[1];if(X[t])n.import_view(X[t]);else{Z=!1;var r=e[2];r&&n.exec(r).then(function(){Z=!0,X[t]=n.export_view()})}}function $(){Z&&(V=!1,location.hash="#"+e.json_stringify(Y),setTimeout(function(){V=!0},100))}function K(t,r,i){function a(){i||(Z=!0,Ce.historyState&&se.save_state(t,!1),Z=l),c.resolve(),e.isFunction(Ce.onAfterCommand)&&Ce.onAfterCommand(se,t)}te=t,oe&&(oe=!1,(Ce.historyState||Ce.execHash&&i)&&(X.length?se.save_state(null):se.save_state()));try{if(e.isFunction(Ce.onBeforeCommand)&&Ce.onBeforeCommand(se,t)===!1)return;i||(le=e.terminal.split_command(t)),q()||i&&(e.isFunction(Ce.historyFilter)&&Ce.historyFilter(t)||t.match(Ce.historyFilter))&&Ke.history().append(t);var s=Oe.top();!r&&Ce.echoCommand&&j(t);var c=new e.Deferred,l=Z;if(t.match(/^\s*login\s*$/)&&se.token(!0))se.level()>1?se.logout(!0):se.logout(),a();else if(Ce.exit&&t.match(/^\s*exit\s*$/)&&!be){var u=se.level();(1==u&&se.get_token()||u>1)&&(se.get_token(!0)&&se.set_token(n,!0),se.pop()),a()}else if(Ce.clear&&t.match(/^\s*clear\s*$/)&&!be)se.clear(),a();else{var f=ve.length-1,p=s.interpreter.call(se,t,se);if(p!==n)return se.pause(!0),e.when(p).then(function(e){e&&f===ve.length-1&&o(e),a(),se.resume()});if(Fe){ae.push(function(){a()})}else a()}return c.promise()}catch(h){throw k(h,"USER"),se.resume(),h}}function N(){if(e.isFunction(Ce.onBeforeLogout))try{if(Ce.onBeforeLogout(se)===!1)return}catch(n){k(n,"onBeforeLogout")}if(P(),e.isFunction(Ce.onAfterLogout))try{Ce.onAfterLogout(se)}catch(n){k(n,"onAfterlogout")}se.login(Ce.login,!0,H)}function P(){var n=se.prefix_name(!0)+"_";e.Storage.remove(n+"token"),e.Storage.remove(n+"login")}function L(n){var t=se.prefix_name()+"_interpreters",r=e.Storage.get(t);r=r?e.parseJSON(r):[],-1==e.inArray(n,r)&&(r.push(n),e.Storage.set(t,e.json_stringify(r)))}function B(n){var t=Oe.top(),r=se.prefix_name(!0);q()||L(r),Ke.name(r),e.isFunction(t.prompt)?Ke.prompt(function(e){t.prompt(e,se)}):Ke.prompt(t.prompt),Ke.set(""),!n&&e.isFunction(t.onStart)&&t.onStart(se)}function H(){function n(){if(V&&Ce.execHash)try{if(location.hash){var n=location.hash.replace(/^#/,"");Y=e.parseJSON(decodeURIComponent(n))}else Y=[];Y.length?R(Y[Y.length-1]):X[0]&&se.import_view(X[0])}catch(t){k(t,"TERMINAL")}}B(),A();var t=!1;if(e.isFunction(Ce.onInit)){ke=function(){t=!0};try{Ce.onInit(se)}catch(r){k(r,"OnInit")}finally{ke=e.noop,t||se.resume()}}ee&&(ee=!1,e.fn.hashchange?e(window).hashchange(n):e(window).bind("hashchange",n))}function W(n,t,r){Ce.clear&&-1==e.inArray("clear",r)&&r.push("clear"),Ce.exit&&-1==e.inArray("exit",r)&&r.push("exit");var i=Ke.get().substring(0,Ke.position());if(i===n){for(var o=new RegExp("^"+e.terminal.escape_regex(t)),a=[],s=r.length;s--;)o.test(r[s])&&a.push(r[s]);if(1===a.length)se.insert(a[0].replace(o,""));else if(a.length>1)if(de>=2){j(n);var c=a.reverse().join("	");se.echo(e.terminal.escape_brackets(c),{keepWords:!0}),de=0}else{var l,u=!1;e:for(l=t.length;l<a[0].length;++l){for(s=1;s<a.length;++s)if(a[0].charAt(l)!==a[s].charAt(l))break e;u=!0}u&&se.insert(a[0].slice(0,l).replace(o,""))}}}function q(){return be||Ke.mask()!==!1}function J(t){var r,i,o,a=Oe.top();if(!se.paused()&&se.enabled()){if(e.isFunction(a.keydown)){if(r=a.keydown(t,se),r!==n)return r}else if(e.isFunction(Ce.keydown)&&(r=Ce.keydown(t,se),r!==n))return r;if(o=Ce.completion&&"boolean"!=e.type(Ce.completion)&&a.completion===n?Ce.completion:a.completion,"settings"==o&&(o=Ce.completion),se.oneTime(10,function(){Ae()}),9!==t.which&&(de=0),68===t.which&&t.ctrlKey)return be||(""===Ke.get()?Oe.size()>1||Ce.login!==n?se.pop(""):(se.resume(),se.echo("")):se.set_command("")),!1;if(76===t.which&&t.ctrlKey)se.clear();else{if(o&&9===t.which){++de;var s,c=Ke.position(),l=Ke.get().substring(0,c),u=l.split(" ");if(1==Se.length)s=u[0];else for(s=u[u.length-1],i=u.length-1;i>0&&"\\"==u[i-1][u[i-1].length-1];i--)s=u[i-1]+" "+s;switch(e.type(o)){case"function":o(se,s,function(e){W(l,s,e)});break;case"array":W(l,s,o);break;default:throw new Error(Se.invalidCompletion)}return!1}if((118===t.which||86===t.which)&&(t.ctrlKey||t.metaKey))return void se.oneTime(1,function(){x()});if(9===t.which&&t.ctrlKey){if(Q.length()>1)return se.focus(!1),!1}else 34===t.which?se.scroll(se.height()):33===t.which?se.scroll(-se.height()):se.attr({scrollTop:se.attr("scrollHeight")})}}else if(68===t.which&&t.ctrlKey){if(G.length){for(i=G.length;i--;){var f=G[i];if(4!==f.readyState)try{f.abort()}catch(p){se.error(Se.ajaxAbortError)}}G=[],se.resume()}return!1}}function M(){Ne&&se.focus()}function ne(){Ne=Te,se.disable()}var te,re=[],ie=1,oe=!0,ae=[],se=this;if(this.length>1)return this.each(function(){e.fn.terminal.call(e(this),t,e.extend({name:se.selector},r))});if(se.data("terminal"))return se.data("terminal");if(0===se.length)throw sprintf(e.terminal.defaults.strings.invalidSelector,se.selector);var ce,le,ue,fe,pe,he,me,ge,de=0,ve=[],ye=Q.length(),_e=new u,we=e.Deferred(),be=!1,ke=e.noop,xe=[],Ce=e.extend({},e.terminal.defaults,{name:se.selector},r||{}),Se=e.terminal.defaults.strings,Te=Ce.enabled,Fe=!1,Ee=!0;e.extend(se,e.omap({id:function(){return ye},clear:function(){ue.html(""),ve=[];try{Ce.onClear(se)}catch(e){k(e,"onClear")}return se.attr({scrollTop:0}),se},export_view:function(){var n={};if(e.isFunction(Ce.onExport))try{n=Ce.onExport()}catch(t){k(t,"onExport")}return e.extend({},{focus:Te,mask:Ke.mask(),prompt:se.get_prompt(),command:se.get_command(),position:Ke.position(),lines:_(ve),interpreters:Oe.clone()},n)},import_view:function(n){if(be)throw new Error(sprintf(Se.notWhileLogin,"import_view"));if(e.isFunction(Ce.onImport))try{Ce.onImport(n)}catch(t){k(t,"onImport")}return we.then(function(){se.set_prompt(n.prompt),se.set_command(n.command),Ke.position(n.position),Ke.mask(n.mask),n.focus&&se.focus(),ve=_(n.lines),Oe=n.interpreters,E()}),se},save_state:function(t,r,i){if("undefined"!=typeof i?X[i]=se.export_view():X.push(se.export_view()),e.isArray(Y)||(Y=[]),t!==n&&!r){var o=[ye,X.length-1,t];Y.push(o),$()}},exec:function(n,t,r){function i(){e.isArray(n)?!function r(){var e=n.shift();e?se.exec(e,t).then(r):o.resolve()}():Fe?xe.push([n,t,o]):K(n,t,!0).then(function(){o.resolve(se)})}var o=r||new e.Deferred;return"resolved"!=we.state()?we.then(i):i(),o.promise()},autologin:function(e,n,t){return se.trigger("terminal.autologin",[e,n,t]),se},login:function(n,t,r,i){function o(n,o,s){if(o){for(;se.level()>a;)se.pop();Ce.history&&Ke.history().enable();var c=se.prefix_name(!0)+"_";e.Storage.set(c+"token",o),e.Storage.set(c+"login",n),be=!1,e.isFunction(r)&&r()}else t?(s||se.error(Se.wrongPasswordTryAgain),se.pop().set_mask(!1)):(be=!1,s||se.error(Se.wrongPassword),se.pop().pop()),e.isFunction(i)&&i();se.off("terminal.autologin")}if(_e.push([].slice.call(arguments)),be)throw new Error(sprintf(Se.notWhileLogin,"login"));if(!e.isFunction(n))throw new Error(Se.loginIsNotAFunction);if(be=!0,se.token()&&1==se.level()&&!Ee)be=!1,se.logout(!0);else if(se.token(!0)&&se.login_name(!0))return be=!1,e.isFunction(r)&&r(),se;Ce.history&&Ke.history().disable();var a=se.level();return se.on("terminal.autologin",function(e,n,t,r){o(n,t,r)}),se.push(function(e){se.set_mask(Ce.maskChar).push(function(t){try{n.call(se,e,t,function(n,t){o(e,n,t)})}catch(r){k(r,"AUTH")}},{prompt:Se.password+": ",name:"password"})},{prompt:Se.login+": ",name:"login"}),se},settings:function(){return Ce},commands:function(){return Oe.top().interpreter},setInterpreter:function(){return window.console&&console.warn&&console.warn("This function is deprecated, use set_interpreter insead!"),se.set_interpreter.apply(se,arguments)},set_interpreter:function(n,t){function r(){se.pause(),y(n,!!t,function(n){se.resume();var t=Oe.top();e.extend(t,n),B(!0)})}return"string"==e.type(n)&&t?se.login(w(n,t),!0,r):r(),se},greetings:function(){return A(),se},paused:function(){return Fe},pause:function(n){return ke(),!Fe&&Ke&&we.then(function(){Fe=!0,Ke.disable(),n||Ke.hidden(),e.isFunction(Ce.onPause)&&Ce.onPause()}),se},resume:function(){function n(){Fe=!1,Q.front()==se&&Ke.enable(),Ke.visible();var n=xe;xe=[];for(var t=0;t<n.length;++t)se.exec.apply(se,n[t]);se.trigger("resume");var r=ae.shift();r&&r(),x(),e.isFunction(Ce.onResume)&&Ce.onResume()}return Fe&&Ke&&("resolved"!=we.state()?we.then(n):n()),se},cols:function(){return Ce.numChars?Ce.numChars:m(se)},rows:function(){return Ce.numRows?Ce.numRows:g(se)},history:function(){return Ke.history()},history_state:function(e){return e?se.oneTime(1,function(){Ce.historyState=!0,X.length?Q.length()>1&&se.save_state(null):se.save_state()}):Ce.historyState=!1,se},clear_history_state:function(){Y=[],X=[]},next:function(){if(1===Q.length())return se;se.offset().top,se.height(),se.scrollTop();Q.front().disable();var n=Q.rotate().enable(),t=n.offset().top-50;e("html,body").animate({scrollTop:t},500);try{Ce.onTerminalChange(n)}catch(r){k(r,"onTerminalChange")}return n},focus:function(e,n){return we.then(function(){if(1===Q.length())if(e===!1)try{(!n&&Ce.onBlur(se)!==!1||n)&&se.disable()}catch(t){k(t,"onBlur")}else try{(!n&&Ce.onFocus(se)!==!1||n)&&se.enable()}catch(t){k(t,"onFocus")}else if(e===!1)se.next();else{var r=Q.front();if(r!=se&&(r.disable(),!n))try{Ce.onTerminalChange(se)}catch(t){k(t,"onTerminalChange")}Q.set(se),se.enable()}}),se},freeze:function(e){we.then(function(){e?(se.disable(),ge=!0):(ge=!1,se.enable())})},frozen:function(){return ge},enable:function(){return Te||ge||(fe===n&&se.resize(),we.then(function(){Ke.enable(),Te=!0})),se},disable:function(){return Te&&!ge&&we.then(function(){Te=!1,Ke.disable()}),se},enabled:function(){return Te},signature:function(){var e=se.cols(),n=15>e?null:35>e?0:55>e?1:64>e?2:75>e?3:4;return null!==n?U[n].join("\n")+"\n":""},version:function(){return e.terminal.version},cmd:function(){return Ke},get_command:function(){return Ke.get()},set_command:function(e){return we.then(function(){Ke.set(e)}),se},insert:function(e){if("string"==typeof e)return we.then(function(){Ke.insert(e)}),se;throw"insert function argument is not a string"},set_prompt:function(n){return we.then(function(){C("prompt",n)&&(e.isFunction(n)?Ke.prompt(function(e){n(e,se)}):Ke.prompt(n),Oe.top().prompt=n)}),se},get_prompt:function(){return Oe.top().prompt},set_mask:function(e){return we.then(function(){Ke.mask(e===!0?Ce.maskChar:e)}),se},get_output:function(n){return n?ve:e.map(ve,function(n){return e.isFunction(n[0])?n[0]():n[0]}).join("\n")},resize:function(n,t){if(se.is(":visible")){n&&t&&(se.width(n),se.height(t)),n=se.width(),t=se.height();var r=se.cols(),i=se.rows();if(r!==fe||i!==pe){fe=r,pe=i,E();var o=Oe.top();e.isFunction(o.resize)?o.resize(se):e.isFunction(Ce.onResize)&&Ce.onResize(se),me=t,he=n,x()}}else se.stopTime("resize"),se.oneTime(500,"resize",function(){se.resize(n,t)});return se},flush:function(){try{var n;if(e.each(re,function(t,r){if(r===ie)n=e("<div></div>");else if(e.isFunction(r)){n.appendTo(ue);try{r(n)}catch(i){k(i,"USER:echo(finalize)")}}else e("<div/>").html(r).appendTo(n).width("100%")}),Ce.outputLimit>=0){var t=0===Ce.outputLimit?se.rows():Ce.outputLimit,r=ue.find("div div");if(r.length>t){var i=r.length-t+1,o=r.slice(0,i),a=o.parent();o.remove(),a.each(function(){var n=e(this);n.is(":empty")&&n.remove()})}}pe=g(se),Ae(),Ce.scrollOnEcho&&x(),re=[]}catch(s){alert("[Flush] "+b(s)+"\n"+s.stack)}return se},update:function(e,n){return we.then(function(){0>e&&(e=ve.length+e),ve[e]?(null===n?ve.splice(e,1):ve[e][0]=n,E()):se.error("Invalid line number "+e)}),se},last_index:function(){return ve.length-1},echo:function(n,t){return n=n||"",e.when(n).then(function(n){try{var r=e.extend({flush:!0,raw:Ce.raw,finalize:e.noop,keepWords:!1},t||{});r.flush&&(re=[]),F(n,r),ve.push([n,e.extend(r,{exec:!1})]),r.flush&&se.flush()}catch(i){alert("[Terminal.echo] "+b(i)+"\n"+i.stack)}}),se},error:function(n,t){var r=e.terminal.escape_brackets(n).replace(/\\$/,"&#92;").replace(I,"]$1[[;;;error]");return se.echo("[[;;;error]"+r+"]",t)},exception:function(n,t){var r=b(n);if(t&&(r="&#91;"+t+"&#93;: "+r),r&&se.error(r,{finalize:function(e){e.addClass("exception message")}}),"string"==typeof n.fileName&&(se.pause(),e.get(n.fileName,function(e){se.resume();var t=n.lineNumber-1,r=e.split("\n")[t];r&&se.error("["+n.lineNumber+"]: "+r)})),n.stack){var i=e.terminal.escape_brackets(n.stack);se.echo(i.split(/\n/g).map(function(e){return"[[;;;error]"+e.replace(I,function(e){return"]"+e+"[[;;;error]"})+"]"}).join("\n"),{finalize:function(e){e.addClass("exception stack-trace")}})}},scroll:function(e){var n;return e=Math.round(e),ce.prop?(e>ce.prop("scrollTop")&&e>0&&ce.prop("scrollTop",0),n=ce.prop("scrollTop"),ce.scrollTop(n+e)):(e>ce.attr("scrollTop")&&e>0&&ce.attr("scrollTop",0),n=ce.attr("scrollTop"),ce.scrollTop(n+e)),se},logout:function(e){if(be)throw new Error(sprintf(Se.notWhileLogin,"logout"));return we.then(function(){if(e){var t=_e.pop();se.set_token(n,!0),se.login.apply(se,t)}else for(;Oe.size()>0&&!se.pop(););}),se},token:function(n){return e.Storage.get(se.prefix_name(n)+"_token")},set_token:function(n,t){var r=se.prefix_name(t)+"_token";return"undefined"==typeof n?e.Storage.remove(r,n):e.Storage.set(r,n),se},get_token:function(n){return e.Storage.get(se.prefix_name(n)+"_token")},login_name:function(n){return e.Storage.get(se.prefix_name(n)+"_login")},name:function(){return Oe.top().name},prefix_name:function(e){var n=(Ce.name?Ce.name+"_":"")+ye;if(e&&Oe.size()>1){var t=Oe.map(function(e){return e.name}).slice(1).join("_");t&&(n+="_"+t)}return n},read:function(n,t){var r=new e.Deferred;return se.push(function(n){se.pop(),e.isFunction(t)&&t(n),r.resolve(n)},{prompt:n}),r.promise()},push:function(t,r){return we.then(function(){r=r||{};var i={infiniteLogin:!1},o=e.extend({},i,r);!o.name&&le&&(o.name=le.name),o.prompt===n&&(o.prompt=(o.name||">")+" ");var a=Oe.top();a&&(a.mask=Ke.mask());var s=Fe;y(t,!!r.login,function(n){if(Oe.push(e.extend({},n,o)),e.isArray(n.completion)&&o.completion===!0?Oe.top().completion=n.completion:n.completion||o.completion!==!0||(Oe.top().completion=!1),o.login){var r=e.type(o.login);"function"==r?se.login(o.login,o.infiniteLogin,B,o.infiniteLogin?e.noop:se.pop):("string"==e.type(t)&&"string"==r||"boolean"==r)&&se.login(w(t,o.login),o.infiniteLogin,B,o.infiniteLogin?e.noop:se.pop)}else B();s||se.resume()})}),se},pop:function(t){t!==n&&j(t);se.token(!0);if(1==Oe.size()){if(Ce.login){if(N(),e.isFunction(Ce.onExit))try{Ce.onExit(se)}catch(r){k(r,"onExit")}return!0}se.error(Se.canExitError)}else{se.token(!0)&&P();var i=Oe.pop();if(B(),be&&se.get_prompt()!=Se.login+": "&&(be=!1),e.isFunction(i.onExit))try{i.onExit(se)}catch(r){k(r,"onExit")}se.set_mask(Oe.top().mask)}return se},option:function(n,t){if("undefined"==typeof t){if("string"==typeof n)return Ce[n];"object"==typeof n&&e.each(n,function(e,n){Ce[e]=n})}else Ce[n]=t;return se},level:function(){return Oe.size()},reset:function(){return we.then(function(){for(se.clear();Oe.size()>1;)Oe.pop();H()}),se},purge:function(){return we.then(function(){var n=se.prefix_name()+"_",t=e.Storage.get(n+"interpreters");e.each(e.parseJSON(t),function(n,t){e.Storage.remove(t+"_commands"),e.Storage.remove(t+"_token"),e.Storage.remove(t+"_login")}),Ke.purge(),e.Storage.remove(n+"interpreters")}),se},destroy:function(){return we.then(function(){Ke.destroy().remove(),ue.remove(),e(document).unbind(".terminal"),e(window).unbind(".terminal"),se.unbind("click mousewheel mousedown mouseup"),se.removeData("terminal").removeClass("terminal"),Ce.width&&se.css("width",""),Ce.height&&se.css("height",""),e(window).off("blur",ne).off("focus",M),Q.remove(ye)}),se}},function(e,n){return function(){try{return n.apply(se,[].slice.apply(arguments))}catch(t){throw"exec"!==e&&"resume"!==e&&k(t,"TERMINAL"),t}}}));var Ae=function(){var e=v(se);return function(){e!==v(se)&&(se.resize(),e=v(se))}}();Ce.width&&se.width(Ce.width),Ce.height&&se.height(Ce.height);var je=navigator.userAgent.toLowerCase();if(ce=je.match(/(webkit)[ \/]([\w.]+)/)||"body"!=se[0].tagName.toLowerCase()?se:e("html"),e(document).bind("ajaxSend.terminal",function(e,n){G.push(n)}),ue=e("<div>").addClass("terminal-output").appendTo(se),se.addClass("terminal"),Ce.login&&e.isFunction(Ce.onBeforeLogin))try{Ce.onBeforeLogin(se)===!1&&(Ee=!1)}catch(Re){throw k(Re,"onBeforeLogin"),Re}var $e;Ce.login;if("string"==typeof t)$e=t;else if(t instanceof Array)for(var Ie=0,ze=t.length;ze>Ie;++Ie)if("string"==typeof t[Ie]){$e=t[Ie];break}!$e||"string"!=typeof Ce.login&&Ce.login!==!0||(Ce.login=w($e,Ce.login)),Q.append(se);var Oe,Ke,Ne;return y(t,!!Ce.login,function(t){function r(n){var t=Q.get()[n[0]];if(t&&ye==t.id()&&n[2])try{if(Fe){var r=e.Deferred();return ae.push(function(){return t.exec(n[2]).then(function(){t.save_state(n[2],!0,n[1]),r.resolve()})}),r.promise()}return t.exec(n[2]).then(function(){t.save_state(n[2],!0,n[1])})}catch(i){var o=e.terminal.escape_brackets(command),a="Error while exec with command "+o;t.error(a).exception(i)}}(Ce.completion&&"boolean"!=typeof Ce.completion||!Ce.completion)&&(t.completion="settings"),Oe=new u(e.extend({name:Ce.name,prompt:Ce.prompt,keypress:Ce.keypress,keydown:Ce.keydown,resize:Ce.onResize,greetings:Ce.greetings,mousewheel:Ce.mousewheel},t)),Ke=e("<div/>").appendTo(se).cmd({prompt:Ce.prompt,history:Ce.history,historyFilter:Ce.historyFilter,historySize:Ce.historySize,width:"100%",enabled:Te&&!T,keydown:J,keypress:function(n){var t=Oe.top();return e.isFunction(t.keypress)?t.keypress(n,se):e.isFunction(Ce.keypress)?Ce.keypress(n,se):void 0},onCommandChange:function(n){if(e.isFunction(Ce.onCommandChange))try{Ce.onCommandChange(n,se)}catch(t){throw k(t,"onCommandChange"),t}x()},commands:K}),Te&&se.is(":visible")&&!T?se.focus(n,!0):se.disable(),se.oneTime(100,function(){function n(n){var t=e(n.target);!t.closest(".terminal").length&&se.enabled()&&Ce.onBlur(se)!==!1&&se.disable()}e(document).bind("click.terminal",n).bind("contextmenu.terminal",n)});var i=e(window);if(T||i.on("focus",M).on("blur",ne),function(){var n=0,t=!1;se.mousedown(function(){e(window).mousemove(function(){t=!0,n=0,e(window).unbind("mousemove")})}).mouseup(function(){var r=t;t=!1,e(window).unbind("mousemove"),r||1!=++n||(n=0,se.enabled()||ge||(se.focus(),Ke.enable()))})}(),T&&se.click(function(){se.enabled()||ge?se.focus(!1):(se.focus(),Ke.enable())}),se.delegate(".exception a","click",function(n){var t=e(this).attr("href");t.match(/:[0-9]+$/)&&(n.preventDefault(),a(t))}),navigator.platform.match(/linux/i)||se.mousedown(function(e){if(2==e.which){var n=d();se.insert(n)}}),se.is(":visible")&&(fe=se.cols(),Ke.resize(fe),pe=g(se)),Ce.login?se.login(Ce.login,!0,H):H(),se.oneTime(100,function(){i.bind("resize.terminal",function(){if(se.is(":visible")){var e=se.width(),n=se.height();me===n&&he===e||se.resize()}})}),Ce.execHash&&location.hash?setTimeout(function(){try{var n=location.hash.replace(/^#/,"");Y=e.parseJSON(decodeURIComponent(n));var t=0;!function o(){var e=Y[t++];e?r(e).then(o):Z=!0}()}catch(i){}}):Z=!0,e.event.special.mousewheel){var o=!1;e(document).bind("keydown.terminal",function(e){e.shiftKey&&(o=!0)}).bind("keyup.terminal",function(e){(e.shiftKey||16==e.which)&&(o=!1)}),se.mousewheel(function(n,t){if(!o){var r=Oe.top();if(e.isFunction(r.mousewheel)){var i=r.mousewheel(n,t,se);if(i===!1)return}else e.isFunction(Ce.mousewheel)&&Ce.mousewheel(n,t,se);t>0?se.scroll(-40):se.scroll(40)}})}we.resolve()}),se.data("terminal",se),se}}(jQuery);